<div class="page-content">
  @if(form){
  <form [formGroup]="form">
    <!-- Header and edit button -->
    <div style="display: flex; align-items: center">
      <h1 style="flex: 1">{{ formValue.name }}</h1>

      <button mat-stroked-button color="primary" (click)="editMode = !editMode">
        <mat-icon>{{ editMode ? 'edit_off' : 'edit' }}</mat-icon>
        {{ 'Edit' | translate }}
      </button>
    </div>

    <table class="calendar-table">
      <!-- Monthly weather select header -->
      <thead>
        <tr>
          <th></th>
          @for (weatherControl of form.controls.weather.controls; track $index) {
          <th formArrayName="weather">
            <div style="margin-bottom: 8px">
              {{ columnLabels[$index] | translate }}
            </div>
            <picsa-form-weather-select [formControl]="weatherControl"></picsa-form-weather-select>
          </th>
          }
        </tr>
      </thead>
      <!-- Activity rows -->
      <tbody>
        @for(crop of formValue.meta.crops; track $index){
        <tr>
          <td>
            {{ rowLabels[$index] | translate }}
          </td>
          @for(control of activityFormControls[crop].controls; track $index){
          <td>
            <picsa-form-crop-activity-select [formControl]="control"></picsa-form-crop-activity-select>
          </td>
          }
        </tr>
        }
      </tbody>
    </table>
    <!-- Crops edit -->
    @if(editMode){
    <picsa-form-crop-select style="margin-top: 1rem" [formControl]="metaFormControls.crops"></picsa-form-crop-select>
    }
  </form>
  }
</div>
