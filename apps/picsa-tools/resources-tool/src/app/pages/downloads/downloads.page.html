<div class="page-content">
  <div class="flex m-2 flex-wrap gap-4 justify-center">
    <mat-chip-listbox class="flex flex-1 gap-2 min-w-64" (change)="languageFilter.set($event.value)">
      @for(option of languageFilterOptions(); track option.id){
      <mat-chip-option color="primary" [selected]="languageFilter()===option.id" [value]="option.id"
        >{{option.language_label}}</mat-chip-option
      >
      }
    </mat-chip-listbox>
    <!-- Bulk download -->
    @if(bulkDownloadStatus()){
    <button mat-stroked-button class="ml-4" (click)="stopBulkDownload()">
      <mat-icon>cancel</mat-icon> {{ 'Downloading' | translate }} {{bulkDownloadStatus()}}
    </button>
    } @else {
    <button mat-stroked-button class="ml-4" (click)="startBulkDownload()">
      <mat-icon>download</mat-icon> {{ 'Download All' | translate }} {{ pendingDownloadsSize() | sizeMB }} MB
    </button>
    }
  </div>
  <!-- Custom language filter -->

  <div class="w-full overflow-auto mt-2 sm:mt-4">
    <picsa-data-table
      [data]="tableData()"
      [options]="tableOptions"
      [valueTemplates]="{size_kb,title,subtype,language,_downloaded}"
      (rowClick)="handleRowClick($event)"
    >
      <ng-template #size_kb let-value>{{value | sizeMB}} MB</ng-template>
      <ng-template #title let-value>{{value | translate}}</ng-template>
      <ng-template #language let-value>{{languageLabels[value]}}</ng-template>
      <ng-template #subtype let-value>
        @switch (value) { @case ('pdf') {
        <mat-icon svgIcon="resources_tool:filetype_pdf"></mat-icon>
        } @case ('video') {
        <mat-icon svgIcon="resources_tool:filetype_video"></mat-icon>
        } @default {
        <mat-icon svgIcon="resources_tool:filetype_document"></mat-icon>
        } }
      </ng-template>
      <ng-template #_downloaded let-downloaded let-row="row">
        @if(downloaded){
        <button
          mat-icon-button
          [matMenuTriggerFor]="menu"
          aria-label="more options"
          (click)="$event.stopImmediatePropagation()"
        >
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="deleteDownload(row)">
            <mat-icon>delete</mat-icon>
            <span>Delete</span>
          </button>
        </mat-menu>
        } @else {
        <resource-download [resource]="row" (click)="$event.stopImmediatePropagation()"></resource-download>
        }
      </ng-template>
    </picsa-data-table>
  </div>
</div>
