<div class="page-content">
  <h2>Edit Resource</h2>

  <form [formGroup]="form">
    <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
      @for (item of [{code:'global',label:'Global'}]; track $index) {
      <mat-tab [label]="item.label">
        <div class="form-content">
          <!-- Language -->
          <div>
            <label>Language</label>
            <!-- <mat-radio-group formControlName="language">
              @for(language of languagesAvailable(); track language.id){
              <mat-radio-button [value]="language.id">{{ language.language_label }}</mat-radio-button>
              }
            </mat-radio-group> -->
          </div>
          <div style="display: flex; flex-wrap: wrap; gap: 2em">
            <!-- Storage file -->
            <div>
              <label>Resource</label>
              @if(form.value.storage_file ){
              <dashboard-resources-storage-link
                [id]="form.value.storage_file"
                displayStyle="button"
              ></dashboard-resources-storage-link>
              <button
                mat-icon-button
                class="file-remove"
                (click)="handleStorageFileSelected(undefined, 'storage_file')"
              >
                <mat-icon>close</mat-icon>
              </button>
              } @else {
              <picsa-supabase-upload
                [fileTypes]="allowedFileTypes"
                [fileDropHeight]="128"
                [autoUpload]="true"
                storageBucketName="resources"
                [storageFolderPath]="item.code"
                (uploadComplete)="handleUploadComplete($event, 'storage_file')"
              ></picsa-supabase-upload>
              <button
                mat-button
                color="primary"
                supabaseStoragePicker
                storageBucketName="resources"
                [storageFolderPath]="item.code"
                (storageFileSelected)="handleStorageFileSelected($event, 'storage_file')"
                style="margin-top: 4px"
              >
                <mat-icon>perm_media</mat-icon>
                Select existing file
              </button>
              }
            </div>
            <!-- Storage cover -->
            <div style="flex: 1">
              <label>Cover Image</label>
              @if(form.value.storage_cover ){
              <dashboard-resources-storage-link
                #storageLink
                [id]="form.value.storage_cover"
                displayStyle="button"
              ></dashboard-resources-storage-link>
              <button
                mat-icon-button
                class="file-remove"
                (click)="handleStorageFileSelected(undefined, 'storage_cover')"
              >
                <mat-icon>close</mat-icon>
              </button>
              <img class="cover-preview" [src]="storageLink.entry?.publicUrl" style="margin-top: 8px" />

              } @else {
              <picsa-supabase-upload
                [fileTypes]="allowedCoverTypes"
                [fileDropHeight]="128"
                [autoUpload]="true"
                storageBucketName="resources"
                storageFolderPath="covers"
                (uploadComplete)="handleUploadComplete($event, 'storage_cover')"
              ></picsa-supabase-upload>
              <button
                mat-button
                color="primary"
                supabaseStoragePicker
                storageBucketName="resources"
                storageFolderPath="covers"
                (storageFileSelected)="handleStorageFileSelected($event, 'storage_cover')"
                style="margin-top: 4px"
              >
                <mat-icon>perm_media</mat-icon>
                Select existing file
              </button>
              }
            </div>
          </div>
          <!-- Title -->
          <mat-form-field style="flex-basis: 100%">
            <mat-label>Title</mat-label>
            <input matInput formControlName="title" />
          </mat-form-field>
          <!-- Description -->
          <mat-form-field style="flex-basis: 100%">
            <mat-label>Description</mat-label>
            <textarea matInput formControlName="description"></textarea>
          </mat-form-field>
        </div>
      </mat-tab>
      }
    </mat-tab-group>
    <button style="margin-top: 2rem" mat-stroked-button [disabled]="!form.valid" (click)="saveResource()">
      Save Resource
    </button>
  </form>
</div>
