<button
  mat-fab
  class="avatar"
  (click)="dialog.open(profileSelectDialog)"
  [style.background]="activeProfile ? activeProfile.color : 'rgba(255,255,255,0.6)'"
>
  <span *ngIf="activeProfile">{{ activeProfile.initials }}</span>
  <mat-icon *ngIf="!activeProfile">person</mat-icon>
</button>

<!-- Dialog template -->
<ng-template #profileSelectDialog>
  <button mat-icon-button matDialogClose color="primary" class="dialog-close">
    <mat-icon>close</mat-icon>
  </button>
  <h2 class="dialog-title">{{ 'Who is using?' | translate }}</h2>
  <div [ngSwitch]="contentView" class="dialog-content">
    <!-- Profile list -->
    <div *ngSwitchCase="'list'" @fadeInOut>
      <div *ngFor="let profile of profiles">Profile:</div>
      <div class="profile-add-container">
        <button mat-button (click)="setContentView('create')" style="width: 100%; height: 100%">
          <mat-icon>add</mat-icon>
        </button>
        <div style="margin-top: 8px; text-align: center">{{ 'New Profile' | translate }}</div>
      </div>
    </div>

    <!-- Profile Create -->
    <form [formGroup]="profileForm" *ngSwitchCase="'create'" @fadeInOut>
      <mat-form-field style="width: 100%" floatLabel="always" cdkFocusInitial>
        <label for="name">{{ 'Name' | translate }}</label>
        <input matInput formControlName="name" (change)="setInitials()" autoFocus />
      </mat-form-field>
      <div style="display: flex; align-items: center">
        <mat-radio-group formControlName="role" class="layout-column">
          <mat-radio-button value="farmer" style="margin-right: 8px">
            <div>
              <div>{{ 'Farmer' | translate }}</div>
              <mat-icon class="role-icon">person</mat-icon>
            </div>
          </mat-radio-button>
          <mat-radio-button value="extension">
            <div>
              <div>{{ 'Extension' | translate }}</div>
              <mat-icon class="role-icon">groups</mat-icon>
            </div>
          </mat-radio-button>
        </mat-radio-group>
        <button
          mat-fab
          class="avatar"
          style="margin: auto"
          [style.background]="profileForm.value.color"
          (click)="colorPicker.showPicker()"
        >
          {{ profileForm.value.initials }}
        </button>
        <input type="color" #colorPicker formControlName="color" style="visibility: hidden; width: 0" />
      </div>
      <div class="buttons-container">
        <button mat-button (click)="setContentView('list')">Cancel</button>
        <button mat-button (click)="saveProfile()" [disabled]="profileForm.invalid">Save</button>
      </div>
    </form>
  </div>
</ng-template>
